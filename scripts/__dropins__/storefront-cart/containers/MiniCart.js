import{useState as T,useEffect as M}from"@dropins/tools/preact-compat.js";import{s as A,k as R}from"../chunks/resetCart.js";import{events as V}from"@dropins/tools/event-bus.js";import{E as W,S as B}from"../chunks/MiniCart.js";import{classes as O,VComponent as h}from"@dropins/tools/lib.js";import{Divider as H,Price as a,Button as $,CartList as J,CartItem as K,Icon as Y,Image as j}from"@dropins/tools/components.js";import{jsxs as c,jsx as n,Fragment as f}from"@dropins/tools/preact-jsx-runtime.js";import{useText as z}from"@dropins/tools/i18n.js";import{b as Z,u as tt}from"../chunks/updateProductsFromCart.js";import"@dropins/tools/fetch-graphql.js";const et=({className:m,children:s,emptyCart:u,heading:g,products:o,subtotal:d,subtotalExcludingTaxes:p,ctas:e,...v})=>{const I=z({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return c("div",{...v,className:O(["cart-mini-cart",m]),children:[o&&g&&c("div",{className:"cart-mini-cart__heading",children:[n(h,{node:g,className:"cart-mini-cart__heading-text"}),n(H,{variant:"primary",className:"cart-mini-cart__heading-divider"})]}),o?c(f,{children:[n("div",{className:"cart-mini-cart__products",children:o}),c("div",{className:"cart-mini-cart__footer",children:[d&&c("div",{className:"cart-mini-cart__footer__estimated-total",children:[I.subtotal,n(h,{node:d})]}),p&&c("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes",children:[I.subtotalExcludingTaxes,n(h,{node:p,className:O(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),e&&n(h,{node:e,className:"cart-mini-cart__footer__ctas"})]})]}):n(h,{node:u,className:"cart-mini-cart__empty-cart"})]})},nt=({children:m,initialData:s=null,routeProduct:u,routeCart:g,routeCheckout:o,routeEmptyCartCTA:d,...p})=>{var b,N;const[e,v]=T(s),[I,q]=T(new Set),r=(b=A.config)==null?void 0:b.shoppingCartDisplaySetting,_=(t,l)=>{q(y=>(t?y.add(l):y.delete(l),new Set(y)))};M(()=>{const t=V.on("cart/data",l=>{v(l)},{eager:!0});return()=>{t==null||t.off()}},[]);const i=z({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink",discountedPrice:"Cart.CartItem.discountedPrice",heading:"Cart.MiniCart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral"}),F=(t,l)=>{_(!0,t),tt([{uid:t,quantity:l}]).finally(()=>{_(!1,t)})};return M(()=>{s&&Object.keys(s).length>0&&Z(s,A.locale||"en-US")},[s]),n(et,{...p,heading:n("div",{children:i.heading.replace("{count}",((e==null?void 0:e.totalQuantity)??0).toString())}),emptyCart:n(W,{ctaLinkURL:d==null?void 0:d()}),subtotal:(e==null?void 0:e.subtotal)&&((r==null?void 0:r.subtotal)==="INCLUDING_TAX"||(r==null?void 0:r.subtotal)==="INCLUDING_EXCLUDING_TAX"?n(a,{amount:e==null?void 0:e.subtotal.includingTax.value,currency:e==null?void 0:e.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}):n(a,{amount:e==null?void 0:e.subtotal.excludingTax.value,currency:e==null?void 0:e.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}})),subtotalExcludingTaxes:(e==null?void 0:e.subtotal)&&((r==null?void 0:r.subtotal)==="INCLUDING_EXCLUDING_TAX"?n(a,{amount:e==null?void 0:e.subtotal.excludingTax.value,currency:e==null?void 0:e.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0),ctas:c("div",{children:[o&&n($,{variant:"primary",href:e!=null&&e.items.some(t=>t.insufficientQuantity)?void 0:o(),disabled:e==null?void 0:e.items.some(t=>t.insufficientQuantity),"aria-disabled":e==null?void 0:e.items.some(t=>t.insufficientQuantity),tabIndex:e!=null&&e.items.some(t=>t.insufficientQuantity)?-1:0,children:i.checkoutLink}),g&&n($,{variant:"tertiary",href:g(),children:i.cartLink})]}),products:(e==null?void 0:e.totalQuantity)??0?n(J,{children:(N=e==null?void 0:e.miniCartMaxItems)==null?void 0:N.map((t,l)=>{var C,k,x,w,G,U,P,S,X,D,Q,E;const y=I.has(t.uid),L={...t.bundleOptions??{},...t.selectedOptions??{},...t.customizableOptions,...t.recipient?{[i.recipient]:t.recipient}:{},...t.recipientEmail&&t.recipient?{[i.recipient]:`${t.recipient} (${t.recipientEmail})`}:{},...t.sender?{[i.sender]:t.sender}:{},...t.senderEmail&&t.sender?{[i.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[i.message]:t.message}:{},...t.links&&t.links.count?t.links.count>1?{[i.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[i.file.replace("{count}",t.links.count.toString())]:t.links.result}:{}};return n(K,{"data-testid":"cart-item",updating:y,taxIncluded:(r==null?void 0:r.price)==="INCLUDING_TAX",taxExcluded:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX",warning:t.insufficientQuantity||t.lowInventory?c("span",{children:[n(Y,{source:B,size:"16"}),t.insufficientQuantity&&t.stockLevel&&(t.stockLevel==="noNumber"?i.insufficientQuantityGeneral:i.insufficientQuantity.replace("{inventory}",(C=t.stockLevel)==null?void 0:C.toString()).replace("{count}",t.quantity.toString()))||t.lowInventory&&t.onlyXLeftInStock&&i.lowInventory.replace("{count}",(k=t.onlyXLeftInStock)==null?void 0:k.toString())]}):void 0,image:u?n("a",{href:u(t),children:n(j,{loading:l<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}})}):n(j,{loading:l<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}}),title:n("span",{children:u?n("a",{href:u(t),children:t.name}):t.name}),sku:n("span",{children:t.sku}),configurations:Object.keys(L).length>0?L:void 0,quantity:t.quantity,price:(r==null?void 0:r.price)==="INCLUDING_TAX"?n(a,{amount:t.discounted?(x=t.regularPrice)==null?void 0:x.value:(w=t.taxedPrice)==null?void 0:w.value,currency:t.discounted?(G=t.regularPrice)==null?void 0:G.currency:(U=t.taxedPrice)==null?void 0:U.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):n(a,{amount:(P=t.regularPrice)==null?void 0:P.value,currency:(S=t.regularPrice)==null?void 0:S.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"||(r==null?void 0:r.price)==="INCLUDING_TAX"?n(f,{children:t.discounted?c(f,{children:[n(a,{amount:t.total.value,currency:t.total.currency,variant:"strikethrough","data-testid":"including-tax-row-total","aria-label":i.regularPrice}),n(a,{amount:(X=t.rowTotalIncludingTax)==null?void 0:X.value,currency:(D=t.rowTotalIncludingTax)==null?void 0:D.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":i.discountedPrice})]}):n(a,{amount:t.rowTotalIncludingTax.value,currency:t.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":i.regularPrice})}):c(f,{children:[n(a,{amount:t.total.value,currency:t.total.currency,variant:t.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":i.regularPrice}),t.discounted&&n(a,{amount:(Q=t.discountedTotal)==null?void 0:Q.value,currency:(E=t.discountedTotal)==null?void 0:E.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":i.discountedPrice})]}),totalExcludingTax:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"?n(a,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":i.regularPrice}):void 0,onRemove:()=>{F(t.uid,0)}},t.uid)})}):void 0})};nt.getInitialData=async function(){return R()};export{nt as MiniCart,nt as default};
